# ğŸ§  TED AI Curator & Personal Assistant

An intelligent, multi-agent AI system designed to curate, recommend, and analyze TED Talks. Built with **Snowflake Cortex**, **LangGraph**, and **Airflow**, this project demonstrates a modern **RAG (Retrieval-Augmented Generation)** architecture suitable for enterprise-grade applications.

---

## ğŸ—ï¸ Architecture

The system follows a **Hub-and-Spoke** agentic architecture orchestrated by LangGraph, where specialized sub-graphs handle complex tasks:

```mermaid
graph TD
    User((User)) --> Router[Router Agent]

    %% Shared Path for Search-Based Intents
    Router -->|Intent: Recommend| Intent[Intent Agent]
    Router -->|Intent: Playlist| Intent
    Router -->|Intent: Compare| Intent
    
    Intent --> Search[Semantic Search]
    
    %% Branching after Search
    Search -->|Recommend| Rank[Relevance Ranker]
    Search -->|Playlist| Playlist[Playlist Generator]
    Search -->|Compare| Compare[Comparison Agent]
    
    %% Recommendation Completion
    Rank --> Reason[Reasoning Engine]
    Reason --> Final[Final Output]

    %% Direct Resolution Branches
    Router -->|Intent: QA| Resolve[Resolve Talk]
    Router -->|Intent: Summarize| Resolve
    
    Resolve -->|QA| QAPipe[QA Pipeline]
    Resolve -->|Summarize| Summarizer[Video Summarizer]
    QAPipe --> Answer[Grounded Answer]
    
    Router -->|Unknown| Unknown[Unknown Agent]
```

### ğŸ§  Agent Network (Multi-Agent System)

1.  **Router Agent**: The central dispatcher that analyzes user urgency and intent to effectively route queries.
2.  **Recommendation Pipeline (5-Step Chain)**:
    *   **Intent Agent**: Disambiguates vague queries (e.g., "inspiring talks" -> "Leadership/Motivation").
    *   **Semantic Search**: performing hybrid retrieval on vector embeddings.
    *   **Relevance Ranker**: An LLM-based re-ranker that filters noise.
    *   **Reasoning Engine**: Generates personalized "Why this talk?" explanations.
    *   **Formatter**: Structures the output for the UI.
3.  **Playlist Generator Agent**: A hierarchical agent that acts as a curriculum designer. It first retrieves a pool of candidates, then logically groups them into "Foundations", "Core Concepts", and "Advanced" modules.
4.  **Comparison Agent**: A sophisticated analyst agent that:
    *   **Filters**: Selects the top 2-3 most relevant talks.
    *   **Analyzes**: Extracts dimensions (Focus, Audience, Tone).
    *   **Synthesizes**: Produces a side-by-side comparison matrix.
5.  **QA & Summarization Pipeline**:
    *   **Resolution Node**: First identifies *which* talk the user is asking about.
    *   **Retrieval Agent**: Scans the full transcript to find evidence quotes.
    *   **Grounded Answer Agent**: Synthesizes an answer using *only* the retrieved evidence to prevent hallucinations.

---

## ğŸš€ Features

*   **Semantic Search**: Find talks by concept (e.g., "AI ethics") not just keywords.
*   **Smart Recommendations**: Get personalized "Why this talk?" explanations for every suggestion.
*   **Structured Learning Paths**: Generate curated playlists for complex topics (e.g., "Beginner's Guide to Quantum Physics").
*   **Talk Comparison**: "Compare the talk by Simon Sinek vs. Brene Brown" â€“ get a structured analysis of themes and styles.
*   **Chat Persistence**: Auto-saves your conversations and organizes them by title (generated by LLM).
*   **User Personalization**: Tracks watch history and favorites to refine future recommendations.

---

## ï¿½ Detailed Agent Workflows

### 1. Recommendation Pipeline
Designed for discovery (`"Show me talks about AI"`).
```mermaid
graph LR
    Intent[Intent Agent] -->|Extract Topic| Search[Semantic Search]
    Search -->|Top 30 Candidates| Rank[Relevance Ranker]
    Rank -->|Top 5 Selected| Reason[Reasoning Engine]
    Reason -->|Personalized Blurb| Final[Response Formatter]
```

### 2. Playlist Generator
Designed for structured learning (`"Create a learning path for Physics"`).
```mermaid
graph LR
    Intent[Intent Agent] -->|Extract Topic| Search[Semantic Search]
    Search -->|Broad Pool (40+)| Designer[Curriculum Designer]
    Designer -->|Select 7| Found[Step 1: Foundations]
    Designer -->|Select 7| Core[Step 2: Core Concepts]
    Designer -->|Select 7| Adv[Step 3: Advanced]
    Found & Core & Adv --> Final[Formatted Playlist]
```

### 3. Comparison Agent
Designed for analysis (`"Compare Sinek vs Brown"`).
```mermaid
graph LR
    Intent[Intent Agent] -->|Extract Entities| Search[Semantic Search]
    Search -->|Candidate Talks| Filter[Selection Filter]
    Filter -->|Top 2-3 Matches| Matrix[Analysis Matrix]
    Matrix -->|Dimensions: Focus/Tone/Audience| Final[Comparison Table]
```

### 4. QA & Summarization Pipeline
Designed for specific video interaction (`"What does Bill Gates say about X?"`).
```mermaid
graph LR
    Router -->|Target: 'Bill Gates'| Resolver[Resolution Node]
    Resolver -->|Found ID + Transcript| Decision{Intent?}
    
    Decision -->|QA| Retrieve[Transcript Retrieval]
    Retrieve -->|Evidence Quotes| Answer[Grounded Answer]
    
    Decision -->|Summary| Sum[Summarization Agent]
    Sum -->|Transcript| Notes[Key Takeaways]
```

---

## ï¿½ğŸ› ï¸ Technology Stack

*   **Database**: Snowflake (Data Warehousing, Vector Search)
*   **AI/LLM**: Snowflake Cortex (`llama3.1-405b`, `snowflake-arctic-embed-m`)
*   **Orchestration**: Apache Airflow
*   **Transformation**: DBT (Data Build Tool)
*   **Agent Framework**: LangGraph / LangChain
*   **Frontend**: Streamlit
*   **Language**: Python 3.10+

---

## ğŸ“‚ Project Structure

```bash
ted_ai_project/
â”œâ”€â”€ airflow/               # Airflow DAGs & Scripts
â”‚   â”œâ”€â”€ dags/              # ETL Pipelines (S3 Ingestion, Scrapers)
â”‚   â””â”€â”€ docker-compose.yml # Airflow Infrastructure
â”œâ”€â”€ dbt/                   # DBT Project
â”‚   â”œâ”€â”€ models/            # SQL Models (Staging, Curated, Semantic)
â”‚   â””â”€â”€ profiles/          # Connection Profiles
â”œâ”€â”€ snowflake/             # Database Infrastructure (IaC)
â”‚   â””â”€â”€ final_ddl/         # Consolidated DDL for all schemas
â”œâ”€â”€ streamlit_app/         # Frontend Application
â”‚   â”œâ”€â”€ app.py             # Main Entry Point
â”‚   â”œâ”€â”€ langgraph_agents.py# AI Agent Definitions (The "Brain")
â”‚   â””â”€â”€ db.py              # Snowflake Interaction Layer
â””â”€â”€ common/                # Shared Utilities
```

---

## âš¡ Setup & Usage

### Prerequisites
*   Python 3.10+
*   Snowflake Account (with Cortex enabled)
*   Docker (for Airflow)

### 1. Environment Setup
Create a `.env` file in the root directory (see `.env.example`):
```text
SNOWFLAKE_ACCOUNT=...
SNOWFLAKE_USER=...
SNOWFLAKE_PASSWORD=...
SNOWFLAKE_ROLE=TRAINING_ROLE
SNOWFLAKE_WAREHOUSE=TED_AGENT_WH
SNOWFLAKE_DATABASE=TED_DB
SNOWFLAKE_SCHEMA=APP
```

### 2. Run the Application
Navigate to the app directory and launch Streamlit:
```bash
cd streamlit_app
pip install -r requirements.txt
streamlit run app.py
```

### 3. (Optional) Run Airflow Pipeline
To trigger a fresh data ingestion:
```bash
cd airflow
docker-compose up -d
# Access Airflow UI at localhost:8080 (admin/admin)
```

---

## ğŸ›¡ï¸ Security

*   **Credentials**: All sensitive keys are managed via `.env` files and strictly excluded from version control.
*   **RBAC**: Snowflake access is governed by the `TRAINING_ROLE` with least-privilege access.
*   **Public Key Auth**: Snowflake connections use Key-Pair authentication where possible for enhanced security.
